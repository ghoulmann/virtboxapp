#!/bin/bash -ex
#Determine language interpreter

# Declare config variables
#####VARIABLES for CONFIG #########
HOSTNAME=vbox
USERNAME=vbox
GROUPNAME=vboxusers
KERNEL_VERSION=`uname -r`
phpvirtualbox=4.2-4
###################################

# set hostname in 2 places
echo "$HOSTNAME" > /etc/hostname
sed -i "s|127.0.1.1 \(.*\)|127.0.1.1 $HOSTNAME|" /etc/hosts

# create the nzb userid (which all the nzb daemons run as)
useradd -c "VirtualBox App userid" -d /home/$USERNAME -g $GROUPNAME -m -s /bin/bash "$USERNAME"
#is this required?
chown -R $USERNAME:$GROUPNAME /home/$USERNAME
#Add to group MAYBE TAKE OUT
usermod -a -G vboxusers $USERNAME


##########not used in this version#################
#VB Repository Signage Key
#echo "deb http://download.virtualbox.org/virtualbox/debian squeeze contrib non-free" >> /etc/apt/sources.list.d/virtbox.list
#wget -q http://download.virtualbox.org/virtualbox/debian/oracle_vbox.asc -O- | apt-key add -
###################################################

# Install with apt
apt-get update
DEBIAN_FRONTEND=noninteractive apt-get -y \
    -o DPkg::Options::=--force-confdef \
    -o DPkg::Options::=--force-confold \
    install python-software-properties \
	dkms \
	linux-headers-$KV \
	apache2 \
	libapache2-mod-php5 \
	php5-cli

echo "VBOXWEB_USER=${USERNAME}"                > /etc/default/virtualbox
echo "VBOXWEB_HOST=127.0.0.1"                 >> /etc/default/virtualbox
echo "VBOXWEB_PORT=18083"                     >> /etc/default/virtualbox
echo "VBOXWEB_LOGFILE=/home/vbox/vboxweb.log" >> /etc/default/virtualbox

#get extension pack
wget http://download.virtualbox.org/virtualbox/4.2.12/Oracle_VM_Virtualbox_Extension_Pack-4.2.12-84980.vbox-extpack
virtualbox Oracle

#Download PHPVirtualbox
wget http://phpvirtualbox.googlecode.com/files/phpvirtualbox-$phpvirtualbox.zip
unzip phpvirtualbox-$phpvirtualbox.zip
mv phpvirtualbox-$phpvirtualbox/* /var/www
#Create config.php file
cd /var/www && mv config.php-example config.php

# Create and config the confconsole services.txt file
echo "PHPVirtualBox:  http://$ipaddr" > /etc/confconsole/services.txt
echo "Web Shell:      http://$ipaddr:12320"           >> /etc/confconsole/services.txt
echo "Webmin:         http://$ipaddr:12321"           >> /etc/confconsole/services.txt

exit 0




